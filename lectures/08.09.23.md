

# Оболочка Shell 

- командный интерпретатор
- текстовый интерфейс командной строки
- запуск программ
- автоматицазия действий в виде программ
- множество видов: sh, bash, ksh, csh

## Системные вызовы

1. Прямые точки входа пользовательских процессов в ядро 
2. Выполняются в привелегированном режима для доступа к системным данным/устройствам
3. Реализованы по разному в различных ядрах
4. Отображаются в вызовы функций языка **C** -> интерфейс системных вызовов - стандартная UNIX-библиотека libc
5. Стандарт POSIX = Portable Operating System Interface

```c
#include <unistd.h> //<- int getuid()
#include <stdio.h>  //<- void perror(char*)

int main(int argc, char * argv[]){
    int ret = getuid();
    perror("getuid result");
    return ret;
}
```

### Возвращаемое значение
- `-1` - ошибка
- `>=0` - успех

#
- Точный код ошибки - в глобальной переменной `errno`
- При успешном завершении errno не меняется
- Расшифровка последнего кода ошибки - функция `perror(char*)`

# Синтаксис команд Unix

## Команда и аргументы
- **$ command arg1 arg2 ... arg3**
  
### Аргументы, как опции:
#### Короткий формат
- `-a`
- `-A`
- `-bc`
#### Длинный формат
- `--help`
- `--verbose`
#### Типичное описание в документации
- `command [arg1] [arg2] arg3`
- [arg1] - необязательный аргумент aeg1
- arg3 - обязательный аргумент arg3

### Позиционные аргументы
`ls -l - a,` `ls --all,` `ls --help` 

`--help=command`

#
```bash
$ man command // посмотреть мануал
$ ps aux // все процессы
$ grep "test" // поиск
```
#

## Потоки вводы-вывода
```c
                                            ____________
                                            |          |
___________           ___________       |-->| #1 stdout|
|         |           |         |       |   |__________|
| #0 stdin| --------> | command | ------|   _____________
|_________|           |_________|       |   |           |
                                        |-->| #2 stderr |
                                            |___________|
```


```bash
$ ^D - //конец ввода
$ cmd1 -a -b > out_file // чтение из файла
$ cmd1 -a -b >> out_file // чтение из файла
$ cmd1 -e -f < in_file // считывание из файла
$ cmd1 -g -h | cmd2 // конвейер
```

## Подстановки в оболочке (shell expansions)
### В командной строке оболочка заменяет конструкции со спецсимволами *, ?, $, {}, [] ###
1. a*z
- Заменяется на списко имен файлов, имеющихся в текущем каталоге, соответствующих шаблону
- подходят az, abcz, a_z, ...
- *- любое количество символов
1. a?z 
- Заменяется на список файлов имеющихся в текущем каталоге, соотвествующих шаблону
- подходят abz, acz, ..
- НЕ подходят az, abcz, ...
- ? - один любой символ
1. a[b-d]z
- список файлов из текущего каталога по шаблону
- [] - один любой символ из перечисленных
1. a(bc, de, gf)z
- генерирует список abcz, adez, agfz
- безотносительно к файлам или текущему каталогу
1. $var
- подставляет значение переменной по имени var
- задать значение var=value